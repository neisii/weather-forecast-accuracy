# 사용자 결정 사항 기록

**작성일**: 2025-10-08  
**목적**: 리팩토링 과정에서 사용자가 내린 모든 기술적 결정 기록

---

## ✅ 최종 결정 사항

### 1. UI Provider 선택 기능

**결정일**: 2025-10-08

**UI 위치**: 
- A (검색창 옆 드롭다운)

**Provider 표시 방법**:
- 글자색으로 상태 구분
  - 🟢 **초록색**: 사용 가능 (Available)
  - 🟡 **노란색**: 관리자 비활성화 (Disabled by admin)
  - 🔴 **빨간색**: Quota 경고 (80% 이상 사용 또는 통신 불가)

**상세 정보 표시**:
- 일반 사용자: 색상만 표시
- 관리자 페이지: 상세 정보 (호출 수, 응답 시간 등)
  - 예: `OpenWeatherMap (Available - 350/1000 calls)`
  - 향후 개발 예정

**상태 저장 위치**:
- Phase 1: A (로컬 설정 파일, `config/providers.json`)
- Phase 2+: C (백엔드 API)로 마이그레이션

---

### 2. Mock Provider JSON 데이터

**결정일**: 2025-10-08

**데이터 구조**:
- **Option 3**: 단축 키 + Gzip 최적화
- 이유: 파일 크기 75% 감소, 프로덕션 최적화

**포함할 도시**:
- 기본 8개: 서울, 부산, 제주, 인천, 대구, 대전, 광주, 울산

**날씨 상태 다양성**:
- **Option C (하이브리드)**:
  - 기본 8개 도시: 현실적 데이터 (10월 초 평균 기온, 계절 패턴)
  - 테스트 도시: 극단 케이스 추가
    - 테스트_비, 테스트_눈, 테스트_뇌우, 테스트_안개
    - 테스트_폭염, 테스트_한파

**Timestamp 처리**:
- 현재 시간 사용 (동적, `new Date().toISOString()`)

**아이콘 매핑**:
- OpenWeatherMap 아이콘 코드를 표준으로 사용
- 다른 Provider 코드 → 표준으로 변환하는 매핑 테이블 생성

---

### 3. Provider 선택 방식

**결정일**: 2025-10-08

**기본 선택**:
- 환경 변수: `VITE_WEATHER_PROVIDER=openweather|mock`

**UI 전환**:
- 검색창 옆 드롭다운에서 사용자가 직접 선택 가능
- 선택 시 즉시 반영

**사용 불가 Provider 처리**:
- 글자색으로 구분 (🟡 노란색, 🔴 빨간색)
- 선택 가능하지만 경고 메시지 표시

---

### 4. 마이그레이션 전략

**결정일**: 2025-10-08

**방식**:
- **A (점진적)**

**커밋 정책**:
- 각 Phase마다 개별 커밋
- Git 태그 생성: `v0.1.0-refactor-{phase-name}`
- 예: `v0.1.0-refactor-foundation`, `v0.1.0-refactor-adapter-openweather`

**문서화**:
- 각 Phase별 `docs/refactor/PHASE_X_SUMMARY.md` 작성
- 포함 내용:
  - 변경 사항 (추가/수정/삭제 파일)
  - 사용자 요구사항
  - AI 구현 결정
  - 기술적 개선
  - 테스트 결과
  - 다음 단계

**최종 완료**:
- 모든 Phase 완료 후 `v0.2.0-refactor-complete` 태그
- `docs/refactor/FINAL_SUMMARY.md` 작성

---

### 5. 추가 Provider 지원

**결정일**: 2025-10-08

**Phase 1 (현재)**:
- OpenWeatherMap
- MockWeather

**Phase 2+ (향후)**:
- WeatherAPI.com
- Open-Meteo
- 이유: 어댑터 패턴 검증 후 확장

---

### 6. 테스트 범위

**결정일**: 2025-10-08

**Phase 1**:
- Playwright E2E 테스트만 유지
- 기존 테스트 업데이트

**Phase 2+**:
- 어댑터별 단위 테스트 추가 (Vitest)
- WeatherService 통합 테스트
- 점진적 테스트 커버리지 확대

---

### 7. API 호출 제한 추적

**결정일**: 2025-10-08

**Rate Limit 추적**:
- **분당 60회 제한 (Rolling Window)**
- 이유: OpenWeatherMap Free Tier는 60 calls/minute로 제한 (API enforced)
- 구현: LocalStorage에 최근 1분간의 호출 타임스탬프 배열 저장

**분당 제한 감지**:
- HTTP 429 응답 감지 (필수)
- 클라이언트 추적 (LocalStorage, 선택)

**Quota 경고**:
- 80% 사용 시 경고
- Provider 색상 변경 (🔴 빨간색)

---

### 8. 역지오코딩 전략

**결정일**: 2025-10-08

**전략**:
- 사전 정의 좌표 사용 (역지오코딩 API 불필요)

**구현**:
- `config/cityCoordinates.ts` 파일 생성
- 8개 도시의 중심 좌표 저장
- Open-Meteo API 호출 시 좌표 전달

**UI 제약**:
- 드롭다운으로 도시 선택 제한
- 사용자가 임의 도시 입력 불가 (현재 Phase)

**향후 확장**:
- 임의 도시 검색 기능 추가 시:
  - 1단계: 사전 정의 좌표 확인
  - 2단계: Geocoding API 호출 (동적)
  - 3단계: 결과 캐싱

---

### 9. AI 날씨 분석 기능

**결정일**: 2025-10-08

**결정**:
- 현재 리팩토링 범위에서 **제외**
- 향후 기능으로 분리

**문서화**:
- `docs/FUTURE_FEATURES.md` 생성
- AI 기반 정확도 분석, 패턴 예측 등 상세 기록

**우선순위**:
- Phase 2 이후 고려
- 데이터 수집 기간 필요 (최소 30일)

---

## 📝 요구사항 변경 이력

| 날짜 | 항목 | 이전 | 변경 후 | 이유 |
|------|------|------|---------|------|
| 2025-10-08 | Mock JSON 구조 | Option B (원본 포함) | Option 3 (단축 키 + Gzip) | 파일 크기 최적화 |
| 2025-10-08 | 역지오코딩 | 필요 시 API 호출 | 사전 정의 좌표 사용 | API 호출 절약, 간단한 구현 |
| 2025-10-08 | 리셋 로직 | A (브라우저 타임존) | B (UTC 기준) | API 정책과 일치 |
| 2025-10-08 | AI 분석 | 현재 범위 포함 | 향후 기능 분리 | 우선순위 조정 |

---

## 🎯 AI 구현 시 고려 사항

### AI가 기록해야 할 사항

1. **사용자 요구사항**
   - 사용자가 명시적으로 선택한 옵션
   - 우선순위

2. **AI 기술 결정**
   - 구현 방법 선택 이유
   - 대안 비교
   - 트레이드오프

3. **고려한 상황**
   - 성능, 보안, 확장성
   - 향후 마이그레이션 경로

4. **개발자 경험**
   - 디버깅 용이성
   - 코드 가독성
   - 유지보수성

### 문서 작성 원칙

- ✅ 모든 결정에 **이유** 포함
- ✅ 대안과 **비교** 제시
- ✅ 향후 **확장 경로** 명시
- ✅ 사용자 피드백 **반영 여부** 기록

---

## 📚 관련 문서

- [REFACTORING_PLAN.md](./REFACTORING_PLAN.md) - 리팩토링 전체 계획
- [TECHNICAL_QA.md](./TECHNICAL_QA.md) - 기술 질문 답변
- [WEATHER_API_COMPARISON.md](./WEATHER_API_COMPARISON.md) - API 제공자 비교
- [FUTURE_FEATURES.md](./FUTURE_FEATURES.md) - 향후 기능 목록

---

**작성자**: Claude (AI)  
**승인자**: 사용자  
**최종 업데이트**: 2025-10-08
